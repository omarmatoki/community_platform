# ููุฎุต ุงูุชุนุฏููุงุช - ูุธุงู ุงูุชูุซูู ุนุจุฑ WhatsApp

## ุงูุชุนุฏููุงุช ุงููููุฐุฉ โ

ุชู ุชุญููู ูุธุงู ุงูุชูุซูู ุจุงููุงูู ูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุฅูู ุฑูู ุงููุงุชู ูุน ุงูุชุญูู ุนุจุฑ OTP ุนูู WhatsApp.

---

## 1. ุงููููุงุช ุงูุฌุฏูุฏุฉ

### ุฃ) ุงูููุงุฐุฌ (Models)
- **`models/OTP.js`** - ูููุฐุฌ ุฌุฏูุฏ ูุญูุธ ุฑููุฒ OTP
  - ุญูุธ ุงูุฑูุฒ ูุฑูู ุงููุงุชู
  - ุชุชุจุน ุงููุญุงููุงุช (ุญุฏ ุฃูุตู 5)
  - ุตูุงุญูุฉ 10 ุฏูุงุฆู
  - ุฏูุงู ููุชุญูู ูู ุงูุตูุงุญูุฉ

### ุจ) ุงูุฎุฏูุงุช (Services)
- **`services/whatsappService.js`** - ุฎุฏูุฉ WhatsApp
  - ุงูุงุชุตุงู ุจู WhatsApp Web
  - ุฅุฑุณุงู ุฑุณุงุฆู OTP
  - ุฅุฏุงุฑุฉ ุงูุฌูุณุฉ
  - ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

### ุฌ) ุงูุฃุฏูุงุช ุงููุณุงุนุฏุฉ
- **`initWhatsApp.js`** - ุณูุฑูุจุช ูุฑุจุท WhatsApp
  - ุนุฑุถ QR Code
  - ุฑุจุท ุงูุฌูุงุฒ
  - ุญูุธ ุงูุฌูุณุฉ

### ุฏ) ุงูุชูุซูู
- **`WHATSAPP_AUTH_GUIDE.md`** - ุฏููู ุดุงูู ููุงุณุชุฎุฏุงู
- **`.env.example`** - ูุซุงู ููุชุบูุฑุงุช ุงูุจูุฆุฉ
- **`SUMMARY_AR.md`** - ูุฐุง ุงูููู

---

## 2. ุงููููุงุช ุงููุนุฏูุฉ

### ุฃ) models/User.js
```diff
- email: DataTypes.STRING (unique)
+ phoneNumber: DataTypes.STRING (unique)
+ isPhoneVerified: DataTypes.BOOLEAN
```

**ุงูุชุบููุฑุงุช:**
- ุญุฐู ุญูู `email`
- ุฅุถุงูุฉ ุญูู `phoneNumber` ูุน validation ููุฃุฑูุงู ุงูุณุนูุฏูุฉ
- ุฅุถุงูุฉ ุญูู `isPhoneVerified` ูุชุชุจุน ุญุงูุฉ ุงูุชุญูู

### ุจ) models/index.js
```diff
+ const OTP = require('./OTP')(sequelize);
+ OTP, // ูู ุงูุชุตุฏูุฑ
```

**ุงูุชุบููุฑุงุช:**
- ุงุณุชูุฑุงุฏ ูุชุตุฏูุฑ ูููุฐุฌ OTP

### ุฌ) controllers/authController.js
**ุชู ุฅุนุงุฏุฉ ูุชุงุจุฉ ุงูููู ุจุงููุงูู**

**ุงูู Endpoints ุงูุฌุฏูุฏุฉ:**
1. `sendOTP` - ุฅุฑุณุงู ุฑูุฒ OTP
2. `resendOTP` - ุฅุนุงุฏุฉ ุฅุฑุณุงู (ูุน ุญุฏ ุฒููู ุฏูููุชูู)
3. `verifyOTP` - ุงูุชุญูู ูู ุงูุฑูุฒ ูุงูุชุณุฌูู/ุชุณุฌูู ุงูุฏุฎูู
4. `getProfile` - ุงูุญุตูู ุนูู ุงูููู ุงูุดุฎุตู (ูุญุฏูุซ)
5. `updateProfile` - ุชุญุฏูุซ ุงูุงุณู ููุท (ูุญุฏูุซ)
6. `updatePhoneNumber` - ุชุญุฏูุซ ุฑูู ุงููุงุชู (ุฌุฏูุฏ)

**ุงูู Endpoints ุงููุญุฐููุฉ:**
- โ `register` ุงููุฏููุฉ (ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู)
- โ `login` ุงููุฏููุฉ (ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู)
- โ `changePassword` (ูู ุชุนุฏ ูุทููุจุฉ)

### ุฏ) routes/authRoutes.js
```diff
- POST /register
- POST /login
- PUT /change-password
+ POST /send-otp
+ POST /resend-otp
+ POST /verify-otp
+ PUT /update-phone
```

### ูู) server.js
```diff
+ const whatsappService = require('./services/whatsappService');
+ // ุจุฏุก ุฎุฏูุฉ WhatsApp ุนูุฏ ุชุดุบูู ุงูุณูุฑูุฑ
+ whatsappService.connect()...
```

### ู) package.json
```diff
"scripts": {
  ...
+ "init-whatsapp": "node initWhatsApp.js"
}

"dependencies": {
  ...
+ "whatsapp-web.js": "^1.34.2",
+ "qrcode-terminal": "^0.12.0"
}
```

### ุฒ) .gitignore
```diff
+ # WhatsApp session data
+ .wwebjs_auth/
+ .wwebjs_cache/
```

---

## 3. ุงูููุชุจุงุช ุงููุซุจุชุฉ

```bash
npm install whatsapp-web.js qrcode-terminal
```

- **whatsapp-web.js** - ููุงุชุตุงู ุจู WhatsApp ูุฅุฑุณุงู ุงูุฑุณุงุฆู
- **qrcode-terminal** - ูุนุฑุถ QR Code ูู ุงูุทุฑููุฉ

---

## 4. ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุงูุฅุนุฏุงุฏ ุงูุฃููู (ูุฑุฉ ูุงุญุฏุฉ):

```bash
# 1. ุฑุจุท WhatsApp
npm run init-whatsapp

# 2. ูุณุญ QR Code ุจูุงุณุทุฉ WhatsApp
# 3. ุจุนุฏ ุงูุฑุจุทุ ุงูุฌูุณุฉ ูุญููุธุฉ ุชููุงุฆูุงู
```

### ุชุดุบูู ุงูุณูุฑูุฑ:

```bash
npm run dev
# ุฃู
npm start
```

---

## 5. ุณูุฑ ุงูุนูู ูููุณุชุฎุฏู

### ุงูุชุณุฌูู/ุชุณุฌูู ุงูุฏุฎูู:

1. **ุงููุณุชุฎุฏู ูุทูุจ OTP:**
   ```json
   POST /api/auth/send-otp
   {
     "phoneNumber": "0512345678"
   }
   ```

2. **ูุณุชูู ุฑุณุงูุฉ WhatsApp ุชุญุชูู ุนูู ุฑูุฒ ูู 6 ุฃุฑูุงู**

3. **ูุฏุฎู ุงูุฑูุฒ ูุน ุงุณูู (ููุชุณุฌูู) ุฃู ุจุฏูู (ูุชุณุฌูู ุงูุฏุฎูู):**
   ```json
   POST /api/auth/verify-otp
   {
     "phoneNumber": "0512345678",
     "code": "123456",
     "name": "ุฃุญูุฏ ูุญูุฏ"  // ููุชุณุฌูู ููุท
   }
   ```

4. **ูุญุตู ุนูู JWT Token:**
   ```json
   {
     "success": true,
     "message": "ุชู ุงูุชุณุฌูู ุจูุฌุงุญ",
     "data": {
       "user": {...},
       "token": "jwt-token-here"
     }
   }
   ```

---

## 6. ุงูููุฒุงุช ุงูุฃูููุฉ

- โ **ุตูุงุญูุฉ ูุญุฏูุฏุฉ:** ูู OTP ุตุงูุญ ููุฏุฉ 10 ุฏูุงุฆู ููุท
- โ **ุญุฏ ูุญุงููุงุช:** ุญุฏ ุฃูุตู 5 ูุญุงููุงุช ุฎุงุทุฆุฉ
- โ **ููุน ุงูุชูุฑุงุฑ:** ูุฌุจ ุงูุงูุชุธุงุฑ ุฏูููุชูู ุจูู ูู ุฅุฑุณุงู
- โ **ุฑูู ูุฑูุฏ:** ูุง ูููู ุชุณุฌูู ููุณ ุงูุฑูู ูุฑุชูู
- โ **ุงูุชุญูู ุงูุชููุงุฆู:** ูุชู ุชุนููู `isPhoneVerified = true` ุชููุงุฆูุงู
- โ **Passwordless:** ูุง ุญุงุฌุฉ ููููุงุช ูุฑูุฑ ูุนูุฏุฉ

---

## 7. ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุชุบููุฑุงุช ุนูู ุฌุฏูู `users`:

```sql
-- ุญุฐู
ALTER TABLE users DROP COLUMN email;

-- ุฅุถุงูุฉ
ALTER TABLE users ADD COLUMN phoneNumber VARCHAR(255) NOT NULL UNIQUE;
ALTER TABLE users ADD COLUMN isPhoneVerified BOOLEAN DEFAULT false;
```

### ุฌุฏูู ุฌุฏูุฏ `otps`:

```sql
CREATE TABLE otps (
  id CHAR(36) PRIMARY KEY,
  phoneNumber VARCHAR(255) NOT NULL,
  code VARCHAR(6) NOT NULL,
  expiresAt DATETIME NOT NULL,
  verified BOOLEAN DEFAULT false,
  attempts INT DEFAULT 0,
  createdAt DATETIME,
  updatedAt DATETIME
);
```

---

## 8. ููุงุญุธุงุช ูููุฉ

### ุฑูู ุงููุงุชู:
- ูุฌุจ ุฃู ูููู ุณุนูุฏู (ูุจุฏุฃ ุจู 05)
- ูููู ูู 10 ุฃุฑูุงู
- ููุจู ุงูุชูุณููุงุช: `0512345678`, `+966512345678`, `966512345678`

### WhatsApp:
- ูุฌุจ ุฃู ูููู ุงูุณูุฑูุฑ ูุนูู ุจุงุณุชูุฑุงุฑ ููุญูุงุธ ุนูู ุงูุงุชุตุงู
- ูู ุญุงูุฉ ุงููุทุงุน ุงูุงุชุตุงูุ ูู ุจุชุดุบูู: `npm run init-whatsapp`
- ุงูุฌูุณุฉ ูุญููุธุฉ ูู ูุฌูุฏ `.wwebjs_auth/`

### OTP:
- ุงูุฑูุฒ ูููู ูู 6 ุฃุฑูุงู ุนุดูุงุฆูุฉ
- ุตุงูุญ ููุฏุฉ 10 ุฏูุงุฆู
- ูุชู ุญุฐูู ุชููุงุฆูุงู ุจุนุฏ ุงูุงุณุชุฎุฏุงู

---

## 9. ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

| ุงููุดููุฉ | ุงูุญู |
|---------|------|
| WhatsApp ุบูุฑ ูุชุตู | `npm run init-whatsapp` |
| ุฑูู ุงููุงุชู ุบูุฑ ุตุงูุญ | ุชุฃูุฏ ูู ุงูุชูุณูู ุงูุตุญูุญ |
| ุงูุฑูุฒ ููุชูู | ุงุทูุจ ุฅุนุงุฏุฉ ุฅุฑุณุงู |
| ุชู ุญุธุฑ ุงูุฅุฑุณุงู | ุงูุชุธุฑ ุฏูููุชูู |

---

## 10. ูููุงุช ูููุฑุงุฌุนุฉ

### ุงููููุงุช ุงูุฃุณุงุณูุฉ:
- โ `models/User.js` - ูููุฐุฌ ุงููุณุชุฎุฏู ุงููุญุฏูุซ
- โ `models/OTP.js` - ูููุฐุฌ OTP ุงูุฌุฏูุฏ
- โ `controllers/authController.js` - ููุทู ุงูุชูุซูู ุงูุฌุฏูุฏ
- โ `services/whatsappService.js` - ุฎุฏูุฉ WhatsApp
- โ `routes/authRoutes.js` - ูุณุงุฑุงุช ุงูุชูุซูู ุงููุญุฏูุซุฉ

### ุงูุชูุซูู:
- ๐ `WHATSAPP_AUTH_GUIDE.md` - ุฏููู ุดุงูู ููู API
- ๐ `SUMMARY_AR.md` - ูุฐุง ุงูููู

---

## 11. ุงูุฎุทูุงุช ุงูุชุงููุฉ

### ูุจุฏุก ุงูุงุณุชุฎุฏุงู:

1. **ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
   ```bash
   # ุณูุชู ุฐูู ุชููุงุฆูุงู ุนูุฏ ุชุดุบูู ุงูุณูุฑูุฑ
   npm run dev
   ```

2. **ุฑุจุท WhatsApp:**
   ```bash
   npm run init-whatsapp
   # ุงูุณุญ QR Code
   ```

3. **ุงุฎุชุจุงุฑ ุงูู API:**
   - ุงุณุชุฎุฏู Postman ุฃู cURL
   - ุงุชุจุน ุฃูุซูุฉ ูู `WHATSAPP_AUTH_GUIDE.md`

4. **ุชุญุฏูุซ Frontend:**
   - ุฅุฒุงูุฉ ุญููู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
   - ุฅุถุงูุฉ ุญูู ุฑูู ุงููุงุชู
   - ุฅุถุงูุฉ ุญูู OTP
   - ุชุญุฏูุซ API calls

---

## 12. ููุฎุต ุงูุชุบููุฑุงุช ูู ููุงุท

### โ ุชู:
1. ุชุซุจูุช ููุชุจุงุช WhatsApp
2. ุฅูุดุงุก ูููุฐุฌ OTP
3. ุฅูุดุงุก ุฎุฏูุฉ WhatsApp
4. ุชุนุฏูู ูููุฐุฌ User
5. ุฅุนุงุฏุฉ ูุชุงุจุฉ authController
6. ุชุญุฏูุซ authRoutes
7. ุฅุถุงูุฉ ุฏุนู WhatsApp ููุณูุฑูุฑ
8. ุฅูุดุงุก ุณูุฑูุจุช ุฑุจุท WhatsApp
9. ุชุญุฏูุซ .gitignore
10. ูุชุงุจุฉ ุงูุชูุซูู ุงูุดุงูู

### โ ุชู ุญุฐู:
1. ุญูู email ูู User
2. endpoints ุงููุฏููุฉ (register/login ุงููุฏููุฉ)
3. ูุธุงู ูููุงุช ุงููุฑูุฑ ูููุณุชุฎุฏููู ุงูุนุงุฏููู

### ๐ ุชู ุชุญุฏูุซ:
1. ูุธุงู ุงูุชูุซูู ุจุงููุงูู
2. ุงูููู ุงูุดุฎุตู ูููุณุชุฎุฏู
3. validation rules

---

**ุชู ุจูุฌุงุญ! ๐**

ุงููุธุงู ุงูุขู ุฌุงูุฒ ููุนูู ูุน ุงูุชูุซูู ุนุจุฑ WhatsApp.
