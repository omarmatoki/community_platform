# ุฏููู API ุงููุญุฏูุซ - ูุธุงู ุงูุชูุซูู ุนุจุฑ WhatsApp

## โจ ุงูุชุญุฏูุซุงุช ุงูุฌุฏูุฏุฉ

### 1. **ูุตู ุงูุชุณุฌูู ุนู ุชุณุฌูู ุงูุฏุฎูู**
- ุงูุขู ุงูุชุณุฌูู ูุชุณุฌูู ุงูุฏุฎูู ูููุง endpoints ูููุตูุฉ
- ุงูุชุณุฌูู ูุชุทูุจ ุงูุชุญูู ูู OTP ุฃููุงู ูุจู ุฅูุดุงุก ุงูุญุณุงุจ
- ูุง ูุชู ุชุณุฌูู ุงูุฏุฎูู ุชููุงุฆูุงู ุจุนุฏ ุงูุชุณุฌูู - ูุชู ุจุนุฏ ุงูุชุญูู ูู OTP

### 2. **ุฏุนู ุฌููุน ุงูุฃุฑูุงู ุงูุฏูููุฉ**
- ูู ูุนุฏ ููุงู ููุฏ ุนูู ุงูุฃุฑูุงู ุงูุณุนูุฏูุฉ ููุท
- ูููู ุงุณุชุฎุฏุงู ุฃู ุฑูู ุฏููู ูุน ููุฏ ุงูุฏููุฉ
- ุฃูุซูุฉ ูุฏุนููุฉ:
  - ุณูุฑูุง: `+963998107722`
  - ุงูุณุนูุฏูุฉ: `+966512345678`
  - ูุตุฑ: `+201234567890`
  - ุงูุฅูุงุฑุงุช: `+971501234567`

---

## ๐ฑ API Endpoints ุงููุญุฏูุซุฉ

### ุงูุชุณุฌูู (Register)

#### 1๏ธโฃ ุฅุฑุณุงู OTP ููุชุณุฌูู

**Endpoint:** `POST /api/auth/register/send-otp`

**Request Body:**
```json
{
  "phoneNumber": "+963998107722",
  "name": "ุฃุญูุฏ ูุญูุฏ"
}
```

**Response (Success):**
```json
{
  "success": true,
  "message": "ุชู ุฅุฑุณุงู ุฑูุฒ ุงูุชุญูู ุฅูู ุฑูู ุงููุงุชุณุงุจ ุงูุฎุงุต ุจู",
  "data": {
    "phoneNumber": "+963998107722",
    "expiresIn": "10 ุฏูุงุฆู"
  }
}
```

**Response (Error - ุงูุฑูู ูุณุฌู):**
```json
{
  "success": false,
  "message": "ุฑูู ุงููุงุชู ูุณุฌู ุจุงููุนู. ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู"
}
```

---

#### 2๏ธโฃ ุงูุชุญูู ูู OTP ูุฅุชูุงู ุงูุชุณุฌูู

**Endpoint:** `POST /api/auth/register/verify-otp`

**Request Body:**
```json
{
  "phoneNumber": "+963998107722",
  "code": "123456",
  "name": "ุฃุญูุฏ ูุญูุฏ"
}
```

**Response (Success):**
```json
{
  "success": true,
  "message": "ุชู ุงูุชุณุฌูู ุจูุฌุงุญ",
  "data": {
    "user": {
      "id": "uuid-here",
      "name": "ุฃุญูุฏ ูุญูุฏ",
      "phoneNumber": "+963998107722",
      "points": 0,
      "role": "user",
      "isPhoneVerified": true
    },
    "token": "jwt-token-here"
  }
}
```

---

### ุชุณุฌูู ุงูุฏุฎูู (Login)

#### 1๏ธโฃ ุฅุฑุณุงู OTP ูุชุณุฌูู ุงูุฏุฎูู

**Endpoint:** `POST /api/auth/login/send-otp`

**Request Body:**
```json
{
  "phoneNumber": "+963998107722"
}
```

**Response (Success):**
```json
{
  "success": true,
  "message": "ุชู ุฅุฑุณุงู ุฑูุฒ ุงูุชุญูู ุฅูู ุฑูู ุงููุงุชุณุงุจ ุงูุฎุงุต ุจู",
  "data": {
    "phoneNumber": "+963998107722",
    "expiresIn": "10 ุฏูุงุฆู"
  }
}
```

**Response (Error - ุงูุฑูู ุบูุฑ ูุณุฌู):**
```json
{
  "success": false,
  "message": "ุฑูู ุงููุงุชู ุบูุฑ ูุณุฌู. ูุฑุฌู ุงูุชุณุฌูู ุฃููุงู"
}
```

---

#### 2๏ธโฃ ุงูุชุญูู ูู OTP ูุชุณุฌูู ุงูุฏุฎูู

**Endpoint:** `POST /api/auth/login/verify-otp`

**Request Body:**
```json
{
  "phoneNumber": "+963998107722",
  "code": "654321"
}
```

**Response (Success):**
```json
{
  "success": true,
  "message": "ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ",
  "data": {
    "user": {
      "id": "uuid-here",
      "name": "ุฃุญูุฏ ูุญูุฏ",
      "phoneNumber": "+963998107722",
      "points": 150,
      "role": "user",
      "isPhoneVerified": true
    },
    "token": "jwt-token-here"
  }
}
```

---

### ุฅุนุงุฏุฉ ุฅุฑุณุงู OTP

**Endpoint:** `POST /api/auth/resend-otp`

**Request Body:**
```json
{
  "phoneNumber": "+963998107722"
}
```

**ููุงุญุธุฉ:**
- ุชุนูู ุชููุงุฆูุงู ููุชุณุฌูู ุฃู ุชุณุฌูู ุงูุฏุฎูู ุญุณุจ ุญุงูุฉ ุงููุณุชุฎุฏู
- ูุฌุจ ุงูุงูุชุธุงุฑ ุฏูููุชูู ุจูู ูู ุฅุฑุณุงู

---

## ๐ ุชูุณููุงุช ุฃุฑูุงู ุงููุงุชู ุงูููุจููุฉ

### ุงููุงุนุฏุฉ ุงูุนุงูุฉ:
```
^\+?[1-9]\d{1,14}$
```

### ุฃูุซูุฉ ุตุญูุญุฉ:
- โ `+963998107722` (ุณูุฑูุง)
- โ `+966512345678` (ุงูุณุนูุฏูุฉ)
- โ `+201234567890` (ูุตุฑ)
- โ `+971501234567` (ุงูุฅูุงุฑุงุช)
- โ `+905551234567` (ุชุฑููุง)
- โ `+96171234567` (ูุจูุงู)
- โ `963998107722` (ุจุฏูู +)

### ุฃูุซูุฉ ุฎุงุทุฆุฉ:
- โ `0998107722` (ุจุฏูู ููุฏ ุงูุฏููุฉ)
- โ `+963 998 107 722` (ุจู ูุณุงูุงุช)
- โ `+963-998-107-722` (ุจู ุดุฑุทุงุช)
- โ `00963998107722` (00 ุบูุฑ ููุจูู)

---

## ๐ ุณูุฑ ุงูุนูู ุงููุงูู

### ูููุณุชุฎุฏู ุงูุฌุฏูุฏ (ุงูุชุณุฌูู):

```
1. Frontend: ุฅุฑุณุงู phoneNumber + name
   POST /api/auth/register/send-otp
   โ
2. Backend: ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุงููุณุชุฎุฏู
   โ
3. Backend: ุฅุฑุณุงู OTP ุนุจุฑ WhatsApp
   โ
4. ุงููุณุชุฎุฏู: ูุณุชูู ุงูุฑูุฒ ุนูู WhatsApp
   โ
5. Frontend: ุฅุฑุณุงู phoneNumber + code + name
   POST /api/auth/register/verify-otp
   โ
6. Backend: ุงูุชุญูู ูู ุงูุฑูุฒ
   โ
7. Backend: ุฅูุดุงุก ุงูุญุณุงุจ
   โ
8. Backend: ุฅุฑุฌุงุน Token
```

### ูููุณุชุฎุฏู ุงูููุฌูุฏ (ุชุณุฌูู ุงูุฏุฎูู):

```
1. Frontend: ุฅุฑุณุงู phoneNumber
   POST /api/auth/login/send-otp
   โ
2. Backend: ุงูุชุญูู ูู ูุฌูุฏ ุงููุณุชุฎุฏู
   โ
3. Backend: ุฅุฑุณุงู OTP ุนุจุฑ WhatsApp
   โ
4. ุงููุณุชุฎุฏู: ูุณุชูู ุงูุฑูุฒ ุนูู WhatsApp
   โ
5. Frontend: ุฅุฑุณุงู phoneNumber + code
   POST /api/auth/login/verify-otp
   โ
6. Backend: ุงูุชุญูู ูู ุงูุฑูุฒ
   โ
7. Backend: ุฅุฑุฌุงุน Token
```

---

## ๐ ููุงุฑูุฉ ุจูู ุงููุธุงู ุงููุฏูู ูุงูุฌุฏูุฏ

| ุงูููุฒุฉ | ุงููุธุงู ุงููุฏูู | ุงููุธุงู ุงูุฌุฏูุฏ |
|--------|---------------|---------------|
| ุงูุชุณุฌูู/ุชุณุฌูู ุงูุฏุฎูู | Endpoint ูุงุญุฏ | Endpoints ูููุตูุฉ |
| ุฏุนู ุงูุฃุฑูุงู | ุณุนูุฏูุฉ ููุท | ุฌููุน ุงูุฏูู |
| ุงูุชุญูู ูู ุงูุฑูู | ุงุฎุชูุงุฑู | ุฅุฌุจุงุฑู ููุชุณุฌูู |
| ุฅูุดุงุก ุงูุญุณุงุจ | ุชููุงุฆู | ุจุนุฏ ุงูุชุญูู ูู OTP |

---

## ๐งช ุฃูุซูุฉ Postman

### ูุซุงู 1: ุชุณุฌูู ูุณุชุฎุฏู ุณูุฑู ุฌุฏูุฏ

#### ุงูุฎุทูุฉ 1: ุทูุจ OTP
```
POST http://localhost:4001/api/auth/register/send-otp

Headers:
Content-Type: application/json

Body:
{
  "phoneNumber": "+963998107722",
  "name": "ูุญูุฏ ุงูุฃุญูุฏ"
}
```

#### ุงูุฎุทูุฉ 2: ุงูุชุญูู ูุงูุชุณุฌูู
```
POST http://localhost:4001/api/auth/register/verify-otp

Headers:
Content-Type: application/json

Body:
{
  "phoneNumber": "+963998107722",
  "code": "123456",
  "name": "ูุญูุฏ ุงูุฃุญูุฏ"
}
```

---

### ูุซุงู 2: ุชุณุฌูู ุฏุฎูู ูุณุชุฎุฏู ููุฌูุฏ

#### ุงูุฎุทูุฉ 1: ุทูุจ OTP
```
POST http://localhost:4001/api/auth/login/send-otp

Headers:
Content-Type: application/json

Body:
{
  "phoneNumber": "+963998107722"
}
```

#### ุงูุฎุทูุฉ 2: ุงูุชุญูู ูุชุณุฌูู ุงูุฏุฎูู
```
POST http://localhost:4001/api/auth/login/verify-otp

Headers:
Content-Type: application/json

Body:
{
  "phoneNumber": "+963998107722",
  "code": "654321"
}
```

---

## โ๏ธ ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ

### 1. ูุญุงููุฉ ุงูุชุณุฌูู ุจุฑูู ููุฌูุฏ
```json
{
  "success": false,
  "message": "ุฑูู ุงููุงุชู ูุณุฌู ุจุงููุนู. ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู"
}
```

**ุงูุญู:** ุงุณุชุฎุฏู `/api/auth/login/send-otp` ุจุฏูุงู ูู `/api/auth/register/send-otp`

---

### 2. ูุญุงููุฉ ุชุณุฌูู ุงูุฏุฎูู ุจุฑูู ุบูุฑ ูุณุฌู
```json
{
  "success": false,
  "message": "ุฑูู ุงููุงุชู ุบูุฑ ูุณุฌู. ูุฑุฌู ุงูุชุณุฌูู ุฃููุงู"
}
```

**ุงูุญู:** ุงุณุชุฎุฏู `/api/auth/register/send-otp` ุจุฏูุงู ูู `/api/auth/login/send-otp`

---

### 3. ุฑูู ูุงุชู ุจุชูุณูู ุฎุงุทุฆ
```json
{
  "success": false,
  "errors": [
    {
      "msg": "ุฑูู ุงููุงุชู ุบูุฑ ุตุงูุญ (ูุซุงู: +963998107722)",
      "param": "phoneNumber"
    }
  ]
}
```

**ุงูุญู:** ุงุณุชุฎุฏู ุงูุชูุณูู ุงูุฏููู ูุซู `+963998107722`

---

## ๐ ุงูุฃูุงู

### ุงูุชุญูู ุงูุฅุฌุจุงุฑู:
- โ ูุง ูููู ุฅูุดุงุก ุญุณุงุจ ุจุฏูู ุงูุชุญูู ูู OTP
- โ ูุง ูููู ุชุณุฌูู ุงูุฏุฎูู ุจุฏูู ุงูุชุญูู ูู OTP
- โ ูู OTP ุตุงูุญ ููุฏุฉ 10 ุฏูุงุฆู ููุท
- โ ุญุฏ ุฃูุตู 5 ูุญุงููุงุช ุฎุงุทุฆุฉ

### ุงูุญูุงูุฉ ูู ุงููุฌูุงุช:
- โ Rate limiting: ุฏูููุชูู ุจูู ูู ุฅุฑุณุงู
- โ Unique phone numbers: ุฑูู ูุงุญุฏ ููู ุญุณุงุจ
- โ OTP expiration: ุตูุงุญูุฉ ูุญุฏูุฏุฉ
- โ Attempt limiting: ุญุฏ ูููุญุงููุงุช ุงูุฎุงุทุฆุฉ

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุฑูู ุงููุงุชู ูุฌุจ ุฃู ูููู ุจุงูุตูุบุฉ ุงูุฏูููุฉ:**
   - ุงุจุฏุฃ ุจู `+` ุฃู ุจุฏูููุง
   - ููููุง ููุฏ ุงูุฏููุฉ (ูุซู: 963ุ 966ุ 20ุ ุฅูุฎ)
   - ุซู ุงูุฑูู ุงููุญูู

2. **ุงูุงุณู ูุทููุจ ููุท ุนูุฏ ุงูุชุณุฌูู:**
   - ุนูุฏ `/register/send-otp` ู `/register/verify-otp`
   - ุบูุฑ ูุทููุจ ุนูุฏ `/login/*`

3. **ุฅุนุงุฏุฉ ุฅุฑุณุงู OTP:**
   - ุชุนูู ุชููุงุฆูุงู ููุชุณุฌูู ุฃู ุชุณุฌูู ุงูุฏุฎูู
   - ูุฌุจ ุงูุงูุชุธุงุฑ ุฏูููุชูู ุจูู ูู ุฅุฑุณุงู

4. **WhatsApp ูุฌุจ ุฃู ูููู ูุชุตู:**
   - ุชุฃูุฏ ูู ุชุดุบูู `npm run init-whatsapp` ุฃููุงู
   - ุงูุฌูุณุฉ ูุญููุธุฉ ุชููุงุฆูุงู ุจุนุฏ ุงูุฑุจุท ุงูุฃูู

---

## ๐ ุงูุจุฏุก ุงูุณุฑูุน

### 1. ุฑุจุท WhatsApp:
```bash
npm run init-whatsapp
```

### 2. ุชุดุบูู ุงูุณูุฑูุฑ:
```bash
npm run dev
```

### 3. ุชุฌุฑุจุฉ API:
ุงุณุชุฎุฏู Postman ุฃู cURL ููุงุฎุชุจุงุฑ

---

**ุฌุงูุฒ ููุงุณุชุฎุฏุงู! ๐**
